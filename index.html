<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Is It Raining? — The Overdramatic Oracle</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg0:#070a12;
      --bg1:#0a1020;
      --accent:#66e3ff;
      --accent2:#b7ff5a;
      --danger:#ff2a6d;
      --ok:#00ffb2;
      --glass: rgba(255,255,255,.08);
      --glass2: rgba(255,255,255,.12);
      --shadow: 0 30px 80px rgba(0,0,0,.55);
      --blur: blur(14px);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      color:#eaf2ff;
      font-family:Outfit, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      overflow:hidden;
      background:
        radial-gradient(1200px 900px at 20% 10%, rgba(102,227,255,.18), transparent 60%),
        radial-gradient(900px 700px at 80% 35%, rgba(255,42,109,.14), transparent 65%),
        radial-gradient(1000px 900px at 50% 100%, rgba(183,255,90,.10), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
    }

    /* Subtle moving fog */
    .fog{
      position:absolute; inset:-30%;
      background:
        radial-gradient(closest-side, rgba(255,255,255,.08), transparent 70%),
        radial-gradient(closest-side, rgba(102,227,255,.10), transparent 75%),
        radial-gradient(closest-side, rgba(255,42,109,.08), transparent 70%);
      filter: blur(50px);
      animation:fog 18s linear infinite;
      opacity:.65;
      pointer-events:none;
      mix-blend-mode:screen;
    }
    @keyframes fog{
      0%{transform:translate(-2%,-2%) rotate(0deg) scale(1.03)}
      50%{transform:translate(2%,1.5%) rotate(8deg) scale(1.08)}
      100%{transform:translate(-2%,-2%) rotate(0deg) scale(1.03)}
    }

    /* Decorative background images */
    .gallery{
      position:absolute; inset:0;
      pointer-events:none;
      opacity:.85;
    }
    .floaty{
      position:absolute;
      width:min(28vw, 420px);
      aspect-ratio: 4/3;
      border-radius:24px;
      background-size:cover;
      background-position:center;
      box-shadow: var(--shadow);
      filter: saturate(1.1) contrast(1.05);
      transform: translateZ(0);
      mix-blend-mode: lighten;
      opacity:.35;
      animation: drift 14s ease-in-out infinite;
    }
    .floaty::after{
      content:"";
      position:absolute; inset:0;
      border-radius:24px;
      background: linear-gradient(120deg, rgba(102,227,255,.15), rgba(255,42,109,.08), rgba(183,255,90,.10));
      backdrop-filter: var(--blur);
    }
    @keyframes drift{
      0%{transform: translate(-8px,-10px) rotate(-2deg) scale(1.02)}
      50%{transform: translate(12px,10px) rotate(2deg) scale(1.04)}
      100%{transform: translate(-8px,-10px) rotate(-2deg) scale(1.02)}
    }

    /* Center stage */
    .stage{
      position:absolute; inset:0;
      display:grid;
      place-items:center;
      padding:22px;
    }

    .card{
      width:min(980px, 92vw);
      border-radius:34px;
      background: linear-gradient(180deg, rgba(255,255,255,.09), rgba(255,255,255,.05));
      border: 1px solid rgba(255,255,255,.16);
      box-shadow: 0 40px 130px rgba(0,0,0,.6);
      backdrop-filter: blur(18px);
      overflow:hidden;
      position:relative;
    }

    /* neon border shimmer */
    .card::before{
      content:"";
      position:absolute; inset:-2px;
      background: conic-gradient(from 0deg,
        rgba(102,227,255,.55),
        rgba(255,42,109,.55),
        rgba(183,255,90,.50),
        rgba(102,227,255,.55)
      );
      filter: blur(18px);
      opacity:.35;
      animation: spin 9s linear infinite;
      z-index:0;
    }
    @keyframes spin{to{transform:rotate(360deg)}}

    .card-inner{
      position:relative;
      z-index:1;
      padding:28px 28px 22px;
      display:grid;
      gap:16px;
    }

    header{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:14px;
    }

    .title{
      display:flex;
      flex-direction:column;
      gap:6px;
      min-width: 0;
    }
    .eyebrow{
      letter-spacing:.18em;
      text-transform:uppercase;
      font-size:12px;
      opacity:.85;
    }
    .headline{
      font-family:"Bebas Neue", sans-serif;
      font-size:44px;
      line-height:1;
      margin:0;
      letter-spacing:.02em;
      text-shadow: 0 14px 60px rgba(102,227,255,.22);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .controls{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    .btn{
      appearance:none;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.25);
      color:#eaf2ff;
      padding:10px 12px;
      border-radius:14px;
      font-weight:600;
      cursor:pointer;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      backdrop-filter: blur(10px);
    }
    .btn:hover{ transform: translateY(-1px); background: rgba(255,255,255,.08); border-color: rgba(255,255,255,.28); }
    .btn:active{ transform: translateY(0px) scale(.99); }

    /* The YES/NO */
    .answer-wrap{
      display:grid;
      place-items:center;
      padding:18px 10px 8px;
    }
    .answer{
      position:relative;
      display:grid;
      place-items:center;
      width:min(760px, 85vw);
      height:min(340px, 40vh);
      border-radius:30px;
      border:1px solid rgba(255,255,255,.18);
      background: linear-gradient(180deg, rgba(0,0,0,.30), rgba(0,0,0,.18));
      box-shadow: inset 0 1px 0 rgba(255,255,255,.08), 0 40px 120px rgba(0,0,0,.6);
      overflow:hidden;
      isolation:isolate;
    }
    .answer::before{
      content:"";
      position:absolute; inset:-50%;
      background:
        radial-gradient(circle at 30% 30%, rgba(102,227,255,.25), transparent 45%),
        radial-gradient(circle at 70% 50%, rgba(255,42,109,.20), transparent 50%),
        radial-gradient(circle at 45% 75%, rgba(183,255,90,.15), transparent 48%);
      filter: blur(40px);
      opacity:.8;
      animation: aurora 10s ease-in-out infinite;
      z-index:0;
    }
    @keyframes aurora{
      0%{transform:translate(-2%,-3%) scale(1.02)}
      50%{transform:translate(3%,2%) scale(1.06)}
      100%{transform:translate(-2%,-3%) scale(1.02)}
    }

    .giant{
      font-family:"Bebas Neue", sans-serif;
      font-size: clamp(96px, 14vw, 180px);
      line-height:1;
      letter-spacing:.06em;
      margin:0;
      text-transform:uppercase;
      z-index:2;
      text-shadow:
        0 0 18px rgba(102,227,255,.35),
        0 0 64px rgba(102,227,255,.22),
        0 30px 120px rgba(0,0,0,.65);
    }
    .status{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:center;
      padding:0 18px 8px;
      z-index:2;
      text-align:center;
    }
    .pill{
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.06);
      padding:8px 10px;
      border-radius:999px;
      font-size:12px;
      opacity:.92;
      display:inline-flex;
      gap:8px;
      align-items:center;
      backdrop-filter: blur(10px);
    }
    .dot{
      width:10px; height:10px; border-radius:50%;
      background: rgba(255,255,255,.5);
      box-shadow: 0 0 16px rgba(255,255,255,.35);
    }

    .phrase{
      margin: 10px auto 0;
      max-width: 80ch;
      text-align:center;
      font-size: 15px;
      opacity:.9;
      line-height:1.45;
    }

    footer{
      display:flex;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
      align-items:center;
      padding-top:6px;
      opacity:.9;
    }
    .small{
      font-size:12px;
      opacity:.82;
    }
    .linkish{
      color:var(--accent);
      text-decoration:none;
      border-bottom:1px dashed rgba(102,227,255,.45);
    }

    /* Rain overlay (CSS raindrops) */
    .rain{
      position:absolute; inset:0;
      pointer-events:none;
      z-index:5;
      opacity:.0;
      transition: opacity .6s ease;
      mix-blend-mode: screen;
    }
    .rain.on{opacity:.55;}
    .drop{
      position:absolute;
      top:-20%;
      width: 2px;
      height: 18vh;
      background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(102,227,255,.55), rgba(255,255,255,0));
      filter: blur(.2px);
      animation: fall linear infinite;
      opacity:.65;
    }
    @keyframes fall{
      to{ transform: translateY(140vh); }
    }

    /* Lightning flashes */
    .lightning{
      position:absolute; inset:0;
      background: radial-gradient(circle at 60% 30%, rgba(255,255,255,.55), transparent 55%);
      opacity:0;
      pointer-events:none;
      z-index:6;
      mix-blend-mode: overlay;
    }
    .lightning.flash{
      animation: flash 1.4s ease-out 1;
    }
    @keyframes flash{
      0%{opacity:0}
      8%{opacity:.65}
      16%{opacity:.12}
      22%{opacity:.45}
      40%{opacity:.05}
      100%{opacity:0}
    }

    /* Theme differences for YES/NO */
    .yes .giant{
      color: #eaffff;
      text-shadow:
        0 0 22px rgba(102,227,255,.42),
        0 0 90px rgba(102,227,255,.25),
        0 30px 120px rgba(0,0,0,.70);
    }
    .yes .dot{ background: var(--accent); box-shadow:0 0 18px rgba(102,227,255,.6); }

    .no .giant{
      color: #eafff0;
      text-shadow:
        0 0 22px rgba(0,255,178,.40),
        0 0 90px rgba(0,255,178,.22),
        0 30px 120px rgba(0,0,0,.70);
    }
    .no .dot{ background: var(--ok); box-shadow:0 0 18px rgba(0,255,178,.55); }

    /* Loading + error */
    .loading .giant{opacity:.45; letter-spacing:.14em;}
    .error .giant{color:#ffe9f1; text-shadow:0 0 20px rgba(255,42,109,.35), 0 0 90px rgba(255,42,109,.22), 0 30px 120px rgba(0,0,0,.70);}
    .error .dot{background:var(--danger); box-shadow:0 0 18px rgba(255,42,109,.55);}

    /* Mobile tweaks */
    @media (max-width:520px){
      .headline{font-size:34px}
      .card-inner{padding:20px}
      .answer{height:min(300px, 44vh)}
    }
  </style>
</head>

<body>
  <div class="fog"></div>

  <!-- Decorative floating imagery (Unsplash hotlinks; swap if you want) -->
  <div class="gallery" aria-hidden="true">
    <div class="floaty" style="
      left:-6vw; top:8vh;
      background-image:url('https://images.unsplash.com/photo-1503435824048-a799a3a84bf7?auto=format&fit=crop&w=1200&q=60');
      animation-delay:-3s;"></div>

    <div class="floaty" style="
      right:-10vw; top:18vh;
      background-image:url('https://images.unsplash.com/photo-1526676037777-05a232554f77?auto=format&fit=crop&w=1200&q=60');
      animation-delay:-7s;"></div>

    <div class="floaty" style="
      left:12vw; bottom:-12vh;
      width:min(34vw, 520px);
      background-image:url('https://images.unsplash.com/photo-1501696461415-6bd6660c6742?auto=format&fit=crop&w=1400&q=60');
      animation-delay:-5s;"></div>
  </div>

  <!-- Effects -->
  <div class="rain" id="rainLayer" aria-hidden="true"></div>
  <div class="lightning" id="lightning" aria-hidden="true"></div>

  <main class="stage">
    <section class="card" id="card">
      <div class="card-inner">
        <header>
          <div class="title">
            <div class="eyebrow">The Atmospheric Drama Engine</div>
            <h1 class="headline">Is it raining outside?</h1>
          </div>

          <div class="controls">
            <button class="btn" id="btnRefresh" type="button">Refresh</button>
            <button class="btn" id="btnSound" type="button">Sound: Off</button>
            <button class="btn" id="btnVibes" type="button">Extra Vibes</button>
          </div>
        </header>

        <div class="answer-wrap">
          <div class="answer" id="answerBox">
            <h2 class="giant" id="giant">…</h2>

            <div class="status" id="statusRow">
              <span class="pill"><span class="dot" id="dot"></span><span id="loc">Locating you…</span></span>
              <span class="pill" id="wxPill">Weather: <strong id="wx">—</strong></span>
              <span class="pill" id="rainPill">Rain mm/h: <strong id="rainRate">—</strong></span>
            </div>

            <p class="phrase" id="phrase">
              Asking the sky politely. (It rarely answers politely.)
            </p>
          </div>
        </div>

        <footer>
          <div class="small" id="meta">
            Using browser geolocation + Open-Meteo current conditions.
          </div>
          <div class="small">
            Tip: open over HTTPS (or localhost) so geolocation works.
          </div>
        </footer>
      </div>
    </section>
  </main>

  <!-- Rain sound (replace with your own if you want) -->
  <audio id="rainAudio" loop preload="auto"
    src="https://cdn.pixabay.com/download/audio/2021/08/04/audio_5f4b7d1d2f.mp3?filename=rain-and-thunder-ambient-10561.mp3">
  </audio>

  <script>
    // ---- Phrases ----
    const PHRASES_YES = [
      "YES. The sky is doing cardio on your roof.",
      "YES. The clouds have chosen chaos.",
      "YES. It’s giving: dramatic hydration.",
      "YES. Nature is aggressively misting your existence.",
      "YES. The atmosphere is in its feelings (and they’re wet).",
      "YES. The sky has opened the spillway."
    ];
    const PHRASES_NO = [
      "NO. The sky is behaving (for now).",
      "NO. Dry vibes only. Enjoy the rare peace treaty.",
      "NO. Not raining. The clouds are just lurking.",
      "NO. The universe is withholding precipitation… today.",
      "NO. The sky is currently on silent mode.",
      "NO. Your hair can remain unbothered."
    ];
    const PHRASES_ERR = [
      "I can’t tell. The weather spirits are gatekeeping your data.",
      "Denied. Your browser won’t reveal your coordinates to the storm oracle.",
      "No location, no prophecy. The sky demands permissions.",
      "The radar goblins are asleep. Try refreshing."
    ];

    // ---- Elements ----
    const card = document.getElementById("card");
    const rainLayer = document.getElementById("rainLayer");
    const lightning = document.getElementById("lightning");
    const giant = document.getElementById("giant");
    const locEl = document.getElementById("loc");
    const wxEl = document.getElementById("wx");
    const rainRateEl = document.getElementById("rainRate");
    const phraseEl = document.getElementById("phrase");
    const btnRefresh = document.getElementById("btnRefresh");
    const btnSound = document.getElementById("btnSound");
    const btnVibes = document.getElementById("btnVibes");
    const rainAudio = document.getElementById("rainAudio");

    // ---- State ----
    let soundOn = false;
    let extraVibes = true;

    // Build rain drops once
    function buildRainDrops(count = 140){
      rainLayer.innerHTML = "";
      const vw = Math.max(document.documentElement.clientWidth || 0, window.innerWidth || 0);
      for(let i=0;i<count;i++){
        const d = document.createElement("div");
        d.className = "drop";
        const left = Math.random() * 100;
        const dur = 0.55 + Math.random() * 0.9;
        const delay = -Math.random() * 2.5;
        const height = 12 + Math.random() * 28;
        const opacity = 0.25 + Math.random() * 0.55;
        d.style.left = left + "vw";
        d.style.animationDuration = dur + "s";
        d.style.animationDelay = delay + "s";
        d.style.height = height + "vh";
        d.style.opacity = opacity;
        // Slightly wider on big screens
        d.style.width = (vw > 900 ? (1 + Math.random()*2) : (1 + Math.random()*1.5)) + "px";
        rainLayer.appendChild(d);
      }
    }

    function pick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

    function setMode(mode){
      // modes: loading, yes, no, error
      card.classList.remove("loading","yes","no","error");
      card.classList.add(mode);

      if(mode === "yes"){
        rainLayer.classList.add("on");
      } else {
        rainLayer.classList.remove("on");
      }
    }

    function setPhrase(mode){
      if(mode === "yes") phraseEl.textContent = pick(PHRASES_YES);
      else if(mode === "no") phraseEl.textContent = pick(PHRASES_NO);
      else if(mode === "error") phraseEl.textContent = pick(PHRASES_ERR);
      else phraseEl.textContent = "Consulting the clouds…";
    }

    // Lightning occasionally when raining + extraVibes
    function maybeFlash(){
      if(!extraVibes) return;
      if(!card.classList.contains("yes")) return;
      if(Math.random() < 0.18){
        lightning.classList.remove("flash");
        // force reflow
        void lightning.offsetWidth;
        lightning.classList.add("flash");
      }
    }
    setInterval(maybeFlash, 2200);

    // ---- Weather logic ----
    // Open-Meteo current endpoint (no API key)
    // https://open-meteo.com/
    async function fetchRainStatus(lat, lon){
      const url =
        "https://api.open-meteo.com/v1/forecast" +
        `?latitude=${encodeURIComponent(lat)}` +
        `&longitude=${encodeURIComponent(lon)}` +
        "&current=precipitation,rain,showers,weather_code" +
        "&timezone=auto";

      const res = await fetch(url, { cache: "no-store" });
      if(!res.ok) throw new Error("Weather API request failed.");
      const data = await res.json();

      const cur = data.current || {};
      const rain = Number(cur.rain ?? 0);
      const showers = Number(cur.showers ?? 0);
      const precip = Number(cur.precipitation ?? 0);
      const code = Number(cur.weather_code ?? NaN);

      // Open-Meteo weather codes for rain-ish (common set)
      // Drizzle: 51,53,55,56,57
      // Rain: 61,63,65,66,67,80,81,82
      // Thunderstorm w/ precip: 95,96,99 (may include rain/hail)
      const RAIN_CODES = new Set([51,53,55,56,57,61,63,65,66,67,80,81,82,95,96,99]);

      const rainingNow =
        (rain > 0) || (showers > 0) || (precip > 0) || (RAIN_CODES.has(code));

      return {
        rainingNow,
        rainRate: Math.max(rain, showers, precip),
        code
      };
    }

    function codeToWords(code){
      // Minimal mapping (enough for flavor)
      const map = new Map([
        [0,"Clear"],
        [1,"Mainly clear"],
        [2,"Partly cloudy"],
        [3,"Overcast"],
        [45,"Fog"],
        [48,"Depositing rime fog"],
        [51,"Light drizzle"],
        [53,"Drizzle"],
        [55,"Dense drizzle"],
        [61,"Slight rain"],
        [63,"Rain"],
        [65,"Heavy rain"],
        [80,"Rain showers"],
        [81,"Heavy showers"],
        [82,"Violent showers"],
        [95,"Thunderstorm"],
        [96,"Thunderstorm + hail"],
        [99,"Thunderstorm + heavy hail"]
      ]);
      return map.get(code) ?? `Code ${code}`;
    }

    function getLocation(){
      return new Promise((resolve, reject) => {
        if(!navigator.geolocation) reject(new Error("Geolocation not supported."));
        navigator.geolocation.getCurrentPosition(
          (pos) => resolve(pos.coords),
          (err) => reject(err),
          { enableHighAccuracy: true, timeout: 12000, maximumAge: 60000 }
        );
      });
    }

    async function run(){
      setMode("loading");
      setPhrase("loading");
      giant.textContent = "…";
      wxEl.textContent = "—";
      rainRateEl.textContent = "—";
      locEl.textContent = "Locating you…";

      try{
        const coords = await getLocation();
        const lat = coords.latitude.toFixed(4);
        const lon = coords.longitude.toFixed(4);
        locEl.textContent = `You: ${lat}, ${lon}`;

        const wx = await fetchRainStatus(lat, lon);
        const wxWords = codeToWords(wx.code);
        wxEl.textContent = wxWords;
        rainRateEl.textContent = (isFinite(wx.rainRate) ? wx.rainRate.toFixed(2) : "0.00");

        if(wx.rainingNow){
          setMode("yes");
          setPhrase("yes");
          giant.textContent = "YES";
          if(soundOn) startSound(); else stopSound();
        } else {
          setMode("no");
          setPhrase("no");
          giant.textContent = "NO";
          stopSound();
        }
      } catch(e){
        console.warn(e);
        setMode("error");
        setPhrase("error");
        giant.textContent = "???";
        locEl.textContent = "Location unavailable (permission denied or not HTTPS).";
        wxEl.textContent = "—";
        rainRateEl.textContent = "—";
        stopSound();
      }
    }

    // ---- Sound controls ----
    async function startSound(){
      try{
        rainAudio.volume = 0.65;
        await rainAudio.play();
      } catch (e){
        // Autoplay restrictions: user must interact first
        console.warn("Audio play blocked until user interacts.", e);
      }
    }
    function stopSound(){
      rainAudio.pause();
      rainAudio.currentTime = 0;
    }

    btnSound.addEventListener("click", async () => {
      soundOn = !soundOn;
      btnSound.textContent = `Sound: ${soundOn ? "On" : "Off"}`;
      if(soundOn && card.classList.contains("yes")) await startSound();
      if(!soundOn) stopSound();
    });

    btnVibes.addEventListener("click", () => {
      extraVibes = !extraVibes;
      btnVibes.textContent = extraVibes ? "Extra Vibes" : "Vibes: Minimal";
      // If minimal vibes, kill lightning + tone down rain layer slightly
      lightning.classList.remove("flash");
      rainLayer.style.opacity = extraVibes ? "" : ".35";
    });

    btnRefresh.addEventListener("click", run);

    // Rebuild rain drops on resize
    window.addEventListener("resize", () => buildRainDrops(window.innerWidth < 520 ? 110 : 150));

    // Init
    buildRainDrops(window.innerWidth < 520 ? 110 : 150);
    run();
  </script>
</body>
</html>
